# Admin議案編集機能 要件定義書

## 1. 概要

管理者向けに議案（bills）および議案コンテンツ（bill_contents）を編集する機能を提供する。

## 2. 機能要件

### 2.1 議案基本情報編集機能（Bills編集）

#### 対象テーブル
- `bills`テーブル

#### 編集可能項目
- 議案名（name）
- ステータス（status）
  - introduced: 提出済み
  - in_originating_house: 提出院審議中
  - in_receiving_house: 送付院審議中
  - enacted: 成立
  - rejected: 否決
- 提出院（originating_house）
  - HR: 衆議院
  - HC: 参議院
- ステータス備考（status_note）
- 公開日時（published_at）

#### 画面構成
1. **議案一覧画面**
   - 既存の一覧画面に「編集」ボタンを追加
   - 各議案カードまたは行に編集リンクを配置

2. **議案編集画面**
   - フォーム形式で各項目を編集
   - 保存ボタンとキャンセルボタン
   - バリデーションエラー表示

### 2.2 議案コンテンツ編集機能（Bill Contents編集）

#### 対象テーブル
- `bill_contents`テーブル

#### 編集可能項目（難易度別）
- タイトル（title）
- 要約（summary）
- 本文（content）※Markdown形式

#### 画面構成
1. **コンテンツ一覧画面**
   - 議案ごとにコンテンツ編集リンクを表示
   - 難易度別の編集状況を表示

2. **コンテンツ編集画面**
   - タブ切り替えで3つの難易度を編集
     - やさしい（easy）
     - ふつう（normal）
     - 難しい（hard）
   - 各タブ内にタイトル、要約、本文の入力欄
   - 本文はテキストエリアでMarkdown記述
   - 保存ボタンとキャンセルボタン

## 3. 非機能要件

### 3.1 セキュリティ
- 管理者権限を持つユーザーのみアクセス可能
- 認証済みユーザーのセッションチェック

### 3.2 ユーザビリティ
- 手動保存方式
- 保存成功/失敗のフィードバック表示
- フォームバリデーション（必須項目チェック）
- 変更破棄時の確認ダイアログ

### 3.3 制約事項
- 編集履歴は保存しない
- 編集中の排他制御は実装しない
- Markdownエディタはシンプルなテキストエリア使用

## 4. 画面フロー

### 議案基本情報編集
```
議案一覧画面 → 議案編集画面 → 保存 → 議案一覧画面
              ↓
              キャンセル → 議案一覧画面
```

### 議案コンテンツ編集
```
議案一覧画面 → コンテンツ編集画面 → 保存 → 議案一覧画面
              ↓
              キャンセル → 議案一覧画面
```

## 5. URL構成

- `/admin/bills` - 議案一覧（既存）
- `/admin/bills/[id]/edit` - 議案基本情報編集
- `/admin/bills/[id]/contents/edit` - 議案コンテンツ編集

## 6. データ検証

### 議案基本情報
- name: 必須、最大文字数200文字
- status: 必須、定義済みenumから選択
- originating_house: 必須、HR/HCから選択
- status_note: 任意、最大文字数500文字
- published_at: 必須、日時形式

### 議案コンテンツ
- title: 必須、最大文字数200文字
- summary: 必須、最大文字数1000文字
- content: 必須、Markdown形式

## 7. エラーハンドリング

- バリデーションエラー: フォーム上にエラーメッセージ表示
- サーバーエラー: エラーページまたはトースト通知
- 権限エラー: ログインページへリダイレクト

## 8. 技術仕様

### 使用技術
- Next.js App Router (React Server Components)
- Server Actions for データ更新
- react-hook-form for フォーム管理
- zod for バリデーション
- Tailwind CSS for スタイリング

### コンポーネント構成
```
features/bills/
├── components/
│   ├── bill-edit-form.tsx
│   └── bill-contents-edit-form.tsx
├── actions/
│   ├── update-bill.ts
│   └── update-bill-contents.ts
└── types/
    └── index.ts
```

## 9. 実装優先度

1. 議案基本情報編集機能
2. 議案コンテンツ編集機能（3つの難易度対応）
3. バリデーション強化
4. UX改善（確認ダイアログなど）