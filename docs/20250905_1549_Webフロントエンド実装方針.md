# みらい議会 Web フロントエンド実装方針

## 1. 概要

みらい議会の Web フロントエンドの実装方針と要件定義を定めます。
Bulletproof React アーキテクチャを採用し、保守性と拡張性の高いコードベースを構築します。

## 2. 技術スタック

### コア技術

- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **State Management**: Zustand (必要に応じて)
<!-- - **Data Fetching**: TanStack Query (React Query) -->
- **Database Client**: Supabase Client
<!-- - **Form Management**: React Hook Form + Zod -->
- **UI Components**: Radix UI / shadcn/ui

### 開発ツール

- **Linter**: Biome
- **Formatter**: Biome
- **Testing**: Vitest + React Testing Library
  <!-- - **E2E Testing**: Playwright (将来的に) -->

## 3. ディレクトリ構成

```
web/
├── app/                      # Next.js App Router
│   ├── (public)/            # 公開ページグループ
│   │   ├── page.tsx         # トップページ（議案一覧）
│   │   ├── bills/
│   │   │   └── [id]/
│   │   │       └── page.tsx # 議案詳細ページ
│   │   └── layout.tsx
│   ├── layout.tsx           # ルートレイアウト
│   └── globals.css
├── features/                 # 機能別モジュール (Bulletproof React)
│   ├── bills/               # 議案ドメイン
│   │   ├── api/            # API関連
│   │   │   ├── get-bills.ts
│   │   │   ├── get-bill.ts
│   │   │   └── types.ts
│   │   ├── components/     # 議案関連コンポーネント
│   │   │   ├── bill-card.tsx
│   │   │   ├── bill-list.tsx
│   │   │   ├── bill-detail.tsx
│   │   │   ├── bill-status-badge.tsx
│   │   │   └── index.ts
│   │   ├── hooks/          # カスタムフック
│   │   │   ├── use-bills.ts
│   │   │   └── use-bill.ts
│   │   └── types/          # 型定義
│   │       └── index.ts
│   ├── mirai-stances/       # みらいスタンス
│   │   ├── api/
│   │   ├── components/
│   │   │   ├── stance-badge.tsx
│   │   │   └── stance-comment.tsx
│   │   ├── hooks/
│   │   └── types/
│   └── chats/               # AIチャット機能
│       ├── api/
│       ├── components/
│       ├── hooks/
│       └── types/
├── components/              # 共通UIコンポーネント
│   ├── ui/                 # 基本UIコンポーネント
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── badge.tsx
│   │   └── ...
│   ├── layouts/            # レイアウトコンポーネント
│   │   ├── header.tsx
│   │   ├── footer.tsx
│   │   └── container.tsx
│   └── elements/           # 汎用的な要素
│       ├── loading.tsx
│       ├── error-boundary.tsx
│       └── seo.tsx
├── lib/                     # ライブラリ設定・ユーティリティ
│   ├── supabase/           # Supabase設定
│   │   ├── client.ts
│   │   └── server.ts
│   ├── utils/              # ユーティリティ関数
│   │   ├── date.ts
│   │   └── format.ts
│   └── config/             # アプリケーション設定
│       └── constants.ts
└── types/                   # グローバル型定義
    └── supabase.ts         # 自動生成された型

```

## 4. 機能要件

### Phase 1: MVP（トップページ実装）

#### 4.1 議案一覧表示

- **要件**:

  - 議案の基本情報を一覧表示
  - ステータスによる視覚的な区別
  - スマホファースト
  - レスポンシブデザイン対応

- **表示項目**:

  - 議案名 (name)
  - 見出し (headline)
  - ステータス (status)
  - 公開日 (published_at)

- **機能**:
  - ページネーションは一旦なしで全県表示
  - ソート機能なし
  - フィルタリングなし

#### 4.2 議案詳細表示

- **要件**:
  - 議案の全情報表示
  - マークダウンのレンダリング
  - みらいスタンスとコメントの表示
  - AI チャット機能（Phase 2）

### Phase 2: 機能拡張

- AI チャット機能
- 検索機能
- ユーザー投票機能（認証後）
- コメント機能

## 5. 非機能要件

### パフォーマンス

- First Contentful Paint (FCP): < 1.5 秒
- Time to Interactive (TTI): < 3 秒
- Cumulative Layout Shift (CLS): < 0.1
- SSG/ISR の活用による高速化

### アクセシビリティ

- WCAG 2.1 Level AA 準拠
- キーボードナビゲーション対応
- スクリーンリーダー対応
- 適切な ARIA 属性の使用

### SEO

- 構造化データの実装
- 適切なメタタグ設定
- OGP 対応
- サイトマップ生成

## 6. 実装ガイドライン

### コーディング規約

1. **コンポーネント設計**

   - 単一責任の原則
   - Props Interface の明確な定義
   - コンポーネントの適切な分割

2. **型定義**

   - 全てのコンポーネントで TypeScript を使用
   - any 型の使用禁止
   - 適切な型の共有と再利用

3. **スタイリング**

   - Tailwind CSS のユーティリティファースト
   - カスタムコンポーネントでの cn()ヘルパー使用
   - レスポンシブデザインの徹底

### Bulletproof React 原則

1. **Feature-based 構造**: 機能ごとにモジュール化
2. **明確な責任分離**: API、Components、Hooks、Types の分離
3. **依存関係の管理**: 循環参照を避ける
4. **テスタビリティ**: テストしやすいコード設計

## 7. 実装順序

1. **基盤構築**

   - Supabase クライアント設定
   - 共通 UI コンポーネントセットアップ
   - レイアウトコンポーネント実装

2. **Bills Feature 実装**

   - 型定義
   - API 層実装
   - Hooks 実装
   - コンポーネント実装

3. **トップページ実装**

   - 議案一覧の統合
   - フィルタリング・ソート機能
   - レスポンシブ対応

4. **詳細ページ実装**
   - 動的ルーティング設定
   - 詳細情報表示
   - みらいスタンス表示

## 8. テスト戦略

今回はテスト必要なし

### ユニットテスト

- ユーティリティ関数
- カスタムフック
- 純粋なコンポーネント

### 統合テスト

- API 統合
- ページコンポーネント
- ユーザーフロー

### E2E テスト（将来）

- クリティカルパス
- フォーム送信
- ナビゲーション

## 9. デプロイ戦略

- **ホスティング**: Vercel
- **環境変数管理**: Vercel 環境変数
- **CI/CD**: GitHub Actions + Vercel
- **プレビューデプロイ**: PR ごとの自動デプロイ
