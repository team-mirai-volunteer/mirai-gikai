# 国会会期テーブル設計

## 概要

現在開催中の国会会期情報を管理し、トップページなどで「本日の国会」として表示するためのテーブル。

## 要件

- 国会名（例: 第218回 臨時国会）を文字列で保存
- 会期の開始日・終了日を管理
- 現在日付が会期の範囲内にある場合、UIに表示
- 過去の会期データは管理対象外（現在/直近の会期のみ）
- データの入力・更新は管理画面から行う（管理画面は別作業）

## テーブル定義

### テーブル名: `diet_sessions`

| カラム名 | 型 | NULL | デフォルト | 説明 |
|---------|-----|------|-----------|------|
| id | uuid | NOT NULL | gen_random_uuid() | 主キー |
| name | text | NOT NULL | - | 国会名（例: 第218回 臨時国会） |
| start_date | date | NOT NULL | - | 会期開始日 |
| end_date | date | NOT NULL | - | 会期終了日 |
| created_at | timestamptz | NOT NULL | now() | レコード作成日時 |
| updated_at | timestamptz | NOT NULL | now() | レコード更新日時 |

### 制約

- PRIMARY KEY: `id`
- CHECK制約: `end_date >= start_date`（終了日は開始日以降であること）

### インデックス

- `start_date`, `end_date` に対するインデックス（範囲検索のため）

## データ取得方法

### 現在開催中の国会会期を取得

```sql
SELECT *
FROM diet_sessions
WHERE CURRENT_DATE BETWEEN start_date AND end_date
ORDER BY start_date DESC
LIMIT 1;
```

### 直近の国会会期を取得（会期外の場合）

```sql
SELECT *
FROM diet_sessions
WHERE end_date >= CURRENT_DATE
ORDER BY start_date ASC
LIMIT 1;
```

## RLS (Row Level Security) ポリシー

RLSを有効化し、以下のポリシーを設定：

### SELECT ポリシー
- **ポリシー名**: `diet_sessions_select_policy`
- **対象**: すべてのユーザー（認証なし含む）
- **条件**: なし（全レコード読み取り可能）

```sql
CREATE POLICY "diet_sessions_select_policy" ON diet_sessions
  FOR SELECT
  USING (true);
```

### INSERT/UPDATE/DELETE ポリシー
- **ポリシー名**: `diet_sessions_write_policy`
- **対象**: 認証済みユーザー
- **条件**: 今後管理画面実装時に適切な権限チェックを追加
- **暫定対応**: 認証済みユーザーのみ操作可能

```sql
CREATE POLICY "diet_sessions_write_policy" ON diet_sessions
  FOR ALL
  USING (auth.uid() IS NOT NULL)
  WITH CHECK (auth.uid() IS NOT NULL);
```

※ 将来的に管理者ロールを導入する場合は、ユーザーテーブルのroleカラムなどを参照する形に変更

## マイグレーション

Supabase migration として以下を実装：

1. テーブル作成
2. RLS有効化
3. SELECTポリシー設定（public読み取り可）
4. インデックス作成
5. updated_at 自動更新トリガー設定

## UI表示例

```
本日の国会
会期中
第218回 臨時国会
2025.10.01〜
```

表示ロジック：
- 現在日付が `start_date` と `end_date` の範囲内 → 「会期中」と表示
- 範囲外の場合 → セクション自体を非表示、または「次回会期: {name}」と表示

## 備考

- 会期延長があった場合は、管理画面から `end_date` を更新する運用とする
- 過去の会期データは不要なため、会期終了後は適宜削除または管理画面で非表示にする運用を想定
- 将来的に会期延長の履歴管理が必要になった場合は、別テーブルで管理することを検討
