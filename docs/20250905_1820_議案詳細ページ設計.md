# 議案詳細ページ 設計・実装計画

## 要件定義

### 機能要件

#### 基本表示機能

- 議案の基本情報表示
  - ヘッドライン（要約）
  - 議案名
    <!-- - 議案番号（ID） -->
    <!-- - 発議院（衆議院・参議院） -->
  - 公表日
  - 現在の審議ステータス
  - 詳細説明

#### 議案本文表示

- Markdown で記述された議案本文を適切に表示
- 見出し構造の表示
- リンクや引用等の装飾

#### 政党チームみらいの見解表示

- 賛成・反対・中立の立場表示
- 立場の根拠・コメント表示

#### UI/UX 要件

- 議案一覧からの遷移
<!-- - パンくずナビゲーション -->
- 見やすいレイアウト
- レスポンシブ対応
- アクセシビリティ配慮

### 非機能要件

- SEO 対応
- OGP 対応
- 高速な表示パフォーマンス
- TypeScript 型安全性

## データ構造分析

### 既存データベース構造

```sql
-- bills テーブル
- id: string (UUID)
- name: string (議案名)
- headline: string | null (ヘッドライン)
- description: string | null (詳細説明)
- body_markdown: string | null (本文)
- originating_house: house_enum (発議院)
- published_at: string (公表日)
- status: bill_status_enum (審議ステータス)
- status_note: string | null (ステータス注記)

-- mirai_stances テーブル
- id: string (UUID)
- bill_id: string (議案ID)
- type: stance_type_enum (賛成・反対・中立)
- comment: string | null (コメント)
```

### Enum 定義

```typescript
// house_enum
- "HR": "衆議院"
- "HC": "参議院"

// bill_status_enum
- "introduced": "提出済み"
- "in_originating_house": "発議院審議中"
- "in_receiving_house": "受議院審議中"
- "enacted": "成立"
- "rejected": "否決"

// stance_type_enum
- "for": "賛成"
- "against": "反対"
- "neutral": "中立"
```

## 実装計画

### Phase 1: 基盤構築

1. ページルーティング設定 (`/bills/[id]`)
2. 議案取得 API 関数作成
3. 詳細ページ型定義

### Phase 2: UI コンポーネント開発

1. 議案詳細ページレイアウト
2. 議案ヘッダーコンポーネント
3. 議案本文表示コンポーネント
4. みらい政党見解コンポーネント

### Phase 3: 機能実装

1. Markdown 表示機能
2. OGP/SEO 設定
3. エラーハンドリング
4. ローディング状態

### Phase 4: 改善・最適化

1. パフォーマンス最適化
2. アクセシビリティ対応
<!-- 3. テスト実装 -->

## タスクリスト

### 🔧 基盤構築

- [ ] `web/src/app/bills/[id]/page.tsx` 作成
- [ ] `getBillById` API 関数作成
- [ ] 詳細ページ用型定義追加
- [ ] OGP メタデータ設定

### 🎨 UI コンポーネント

- [ ] `BillDetailHeader` コンポーネント作成
- [ ] `BillContent` コンポーネント作成
- [ ] `MiraiStanceCard` コンポーネント作成
- [ ] `BillDetailLayout` コンポーネント作成

### 📄 コンテンツ表示

- [ ] Markdown パーサー設定
- [ ] コードブロック・表のスタイリング
- [ ] 見出し構造の表示

### 🔗 ナビゲーション

- ヘッダーナビゲーション
  <!-- - [ ] パンくずナビゲーション実装 -->
  <!-- - [ ] 議案一覧へ戻るリンク -->

- [ ] 関連議案表示（将来拡張）

### ⚡ パフォーマンス

一旦気にせずで OK

<!-- - [ ] Static Generation 対応 -->
<!-- - [ ] 画像最適化 -->
<!-- - [ ] Bundle size 最適化 -->

### 🧪 品質保証

- [ ] TypeScript 型チェック
  <!-- - [ ] コンポーネントテスト -->
  <!-- - [ ] E2E テスト -->
- [ ] アクセシビリティテスト

## 技術仕様

### 使用技術

- **Framework**: Next.js 15 (App Router)
- **Styling**: Tailwind CSS + shadcn/ui
- **Markdown**: unified/remark/rehype（react-markdown は使用しない）
- **Database**: Supabase
- **Type Safety**: TypeScript

### なぜ react-markdown を使用しないか

https://blog.stin.ink/articles/replace-react-markdown-with-remark#react-markdown%20%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6 を参照

### ディレクトリ構造

```
web/src/
├── app/bills/[id]/
│   ├── page.tsx              # 詳細ページ
│   ├── loading.tsx           # ローディング状態
│   ├── error.tsx             # エラー状態
│   └── opengraph-image.tsx   # OGP画像生成
├── features/bills/
│   ├── api/
│   │   ├── get-bills.ts      # 一覧取得 (既存)
│   │   └── get-bill-by-id.ts # 詳細取得 (新規)
│   ├── components/（肥大化を防ぐため、listとdetailsでフォルダをわける）
│   │   ├── bill-detail/bill-detail-header.tsx
│   │   ├── bill-detail/bill-content.tsx
│   │   ├── bill-detail/mirai-stance-card.tsx
│   │   └── bill-detail/bill-detail-layout.tsx
│   └── types/
│       └── index.ts          # 型定義追加
└── lib/utils/
    └── markdown.ts           # Markdown関連ユーティリティ
```

## 実装優先度

### High Priority

1. 基本的な議案情報表示
2. 議案本文の Markdown 表示
3. みらい政党見解の表示
4. レスポンシブデザイン

### Medium Priority

1. OGP/SEO 最適化
2. エラーハンドリング強化

### Low Priority

ここは実装なし

1. 関連議案表示
2. 議案のブックマーク機能
3. パフォーマンス最適化
4. 印刷用スタイル

## 注意点

1. **データ型の整合性**: 既存の Supabase 型定義との整合性を保つ
2. **パフォーマンス**: 議案本文が長い場合の表示最適化
3. **アクセシビリティ**: スクリーンリーダー対応、キーボードナビゲーション
4. **SEO**: 動的 OGP 生成、構造化データ
5. **セキュリティ**: XSS 対策（Markdown 表示時）
